{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "1803d5d5-085f-4a70-b27b-1432fe5b19a4",
   "metadata": {},
   "source": [
    "# Homework: Stock Data Analysis\n",
    "\n",
    "Includes all 6 stocks: IBM, MSFT, GOOG, AAPL, AMZN, META.\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "15a2b704",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from pathlib import Path\n",
    "\n",
    "data_dir = Path('/mnt/data')\n",
    "\n",
    "paths = {\n",
    "    'IBM': data_dir/'ibm-1.csv',\n",
    "    'MSFT': data_dir/'msft-1.csv',\n",
    "    'GOOG': data_dir/'goog-1.csv',\n",
    "    'AAPL': data_dir/'aapl-1.csv',\n",
    "    'META': data_dir/'meta-1.csv',\n",
    "    'AMZN': data_dir/'amzn-1.csv',\n",
    "}\n",
    "\n",
    "def load_yahoo_csv(path: Path) -> pd.DataFrame:\n",
    "    df = pd.read_csv(path)\n",
    "    df['Date'] = pd.to_datetime(df['Date'], format='%d-%b-%y', errors='coerce')\n",
    "    if 'Volume' in df.columns:\n",
    "        df['Volume'] = df['Volume'].astype(str).str.replace(',', '', regex=False)\n",
    "    for c in ['Open','High','Low','Close','Adj Close','Volume']:\n",
    "        if c in df.columns:\n",
    "            df[c] = pd.to_numeric(df[c], errors='coerce')\n",
    "    df = df.dropna(subset=['Date']).sort_values('Date').reset_index(drop=True)\n",
    "    return df\n"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "dd65f428",
   "metadata": {},
   "source": [
    "## Problem 1 — IBM 2018"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "a21d8609",
   "metadata": {},
   "outputs": [],
   "source": [
    "ibm = load_yahoo_csv(paths['IBM'])\n",
    "ibm['Trade Value'] = ibm['Close'] * ibm['Volume']\n",
    "\n",
    "highest_close = ibm['Close'].max()\n",
    "avg_close = ibm['Close'].mean()\n",
    "\n",
    "print(f'Highest Close (USD): {highest_close:.4f}')\n",
    "print(f'Average Close (USD): {avg_close:.4f}')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "762ba43b",
   "metadata": {},
   "outputs": [],
   "source": [
    "USDJPY = 107\n",
    "ibm_jpy = ibm.copy()\n",
    "\n",
    "for c in ['Open','High','Low','Close','Adj Close','Trade Value']:\n",
    "    ibm_jpy[c] = ibm_jpy[c] * USDJPY\n",
    "\n",
    "ibm_jpy.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "4d5c22fa",
   "metadata": {},
   "source": [
    "## Problem 2 — Dividend Detection (All 6 Stocks)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "16ccee26",
   "metadata": {},
   "outputs": [],
   "source": [
    "def compute_dividends(df: pd.DataFrame, min_abs_dividend: float = 0.001) -> pd.DataFrame:\n",
    "    r_close = df['Close'].shift(1) / df['Close']\n",
    "    r_adj = df['Adj Close'].shift(1) / df['Adj Close']\n",
    "    dividend = (r_adj - r_close) * df['Close']\n",
    "    out = pd.DataFrame({'Date': df['Date'], 'Dividend': dividend}).dropna()\n",
    "    out = out.loc[out['Dividend'].abs() >= min_abs_dividend]\n",
    "    out = out.loc[out['Dividend'] > 0].copy()\n",
    "    out['Dividend'] = out['Dividend'].round(6)\n",
    "    return out.reset_index(drop=True)\n",
    "\n",
    "stocks = {sym: load_yahoo_csv(path) for sym, path in paths.items()}\n",
    "dividends = {sym: compute_dividends(df) for sym, df in stocks.items()}\n",
    "\n",
    "{sym: len(df) for sym, df in dividends.items()}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "6530e7e8",
   "metadata": {},
   "outputs": [],
   "source": [
    "for sym, df in dividends.items():\n",
    "    print(\"\\n\" + \"=\"*60)\n",
    "    print(sym)\n",
    "    display(df)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python [conda env:base] *",
   "language": "python",
   "name": "conda-base-py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
